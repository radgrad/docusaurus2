<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<link rel="search" type="application/opensearchdescription+xml" title="RadGrad" href="/opensearch.xml"><title data-react-helmet="true">Pub-Sub Caching | RadGrad</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Pub-Sub Caching | RadGrad"><meta data-react-helmet="true" name="description" content="The client and server in traditional web applications communicate using a &quot;request-response&quot; design pattern. RadGrad is implemented using Meteor, which uses a different communication design pattern called &quot;publish-subscribe&quot; (often abbreviated to &quot;pub-sub&quot;).  The basic difference between the two patterns is that with request-response, the client must always make an explicit request to &quot;pull&quot; data from the server, while publish-subscribe enables the server to &quot;push&quot; data to the client. For details on the way Meteor implements pub-sub, please see the Meteor Guide chapter on Publications and data loading."><meta data-react-helmet="true" property="og:description" content="The client and server in traditional web applications communicate using a &quot;request-response&quot; design pattern. RadGrad is implemented using Meteor, which uses a different communication design pattern called &quot;publish-subscribe&quot; (often abbreviated to &quot;pub-sub&quot;).  The basic difference between the two patterns is that with request-response, the client must always make an explicit request to &quot;pull&quot; data from the server, while publish-subscribe enables the server to &quot;push&quot; data to the client. For details on the way Meteor implements pub-sub, please see the Meteor Guide chapter on Publications and data loading."><meta data-react-helmet="true" property="og:url" content="https://radgrad.netlify.com/docs/archive/radgrad2/concepts2/pub-sub-caching"><link data-react-helmet="true" rel="shortcut icon" href="/img/radgrad.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://radgrad.netlify.com/docs/archive/radgrad2/concepts2/pub-sub-caching"><link rel="stylesheet" href="/styles.ed9e915a.css">
<link rel="preload" href="/styles.c903600e.js" as="script">
<link rel="preload" href="/runtime~main.2f1b480c.js" as="script">
<link rel="preload" href="/main.13cd8f17.js" as="script">
<link rel="preload" href="/2.405ef932.js" as="script">
<link rel="preload" href="/3.635484bd.js" as="script">
<link rel="preload" href="/285.d61560bf.js" as="script">
<link rel="preload" href="/288.0762c51c.js" as="script">
<link rel="preload" href="/935f2afb.c899150c.js" as="script">
<link rel="preload" href="/17896441.7618caef.js" as="script">
<link rel="preload" href="/96f83bae.d6c134a5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/radgrad_logo.png" alt="RadGrad"><strong class="navbar__title">RadGrad</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview/motivation">Documentation</a><a class="navbar__item navbar__link" href="/blog">News</a><a class="navbar__item navbar__link" href="/docs/about/opportunities">Join Us</a><a href="https://github.com/radgrad" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://github.com/radgrad/radgrad2/projects/11" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Project Board</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/radgrad_logo.png" alt="RadGrad"><strong class="navbar__title">RadGrad</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/overview/motivation">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">News</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/about/opportunities">Join Us</a></li><li class="menu__list-item"><a href="https://github.com/radgrad" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://github.com/radgrad/radgrad2/projects/11" target="_blank" rel="noopener noreferrer" class="menu__link">Project Board</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Pub-Sub Caching</h1></header><div class="markdown"><p>The client and server in traditional web applications communicate using a &quot;request-response&quot; design pattern. RadGrad is implemented using Meteor, which uses a different communication design pattern called &quot;publish-subscribe&quot; (often abbreviated to &quot;pub-sub&quot;).  The basic difference between the two patterns is that with request-response, the client must always make an explicit request to &quot;pull&quot; data from the server, while publish-subscribe enables the server to &quot;push&quot; data to the client. For details on the way Meteor implements pub-sub, please see the <a href="https://guide.meteor.com/data-loading.html" target="_blank" rel="noopener noreferrer">Meteor Guide chapter on Publications and data loading</a>.</p><p>The point of this section is to note that the default approach to pub-sub in Meteor is on a page-by-page loading basis. In other words, each time a client visits a page, as part of the page loading process, the client creates one or more subscriptions representing all of the data needed for that page, which the server then sends to the client.  Each time the client leaves a page, all current subscriptions are terminated and the associated data is discarded from the client.</p><p>The advantage of the default approach is simplicity and minimization of the data held by the client at any given time. The disadvantage is that if two pages involve the exact same set of subscriptions, and the client navigates from one of these pages to the other, then the default approach results in data being sent to the client for first page, then discarded when the client leaves that page, only to have the server resend the exact same data to the client when the second page is loaded.</p><p>Upon deploying RadGrad for the first time, we discovered that page were loading slowly and that much of this latency was due to the overhead of subscribing and unsubscribing each time the client visited a new page.  To solve this problem, RadGrad leverages the <a href="https://github.com/kadirahq/subs-manager" target="_blank" rel="noopener noreferrer">MeteorHacks SubsManager</a> package, which provides the ability to cache subscription data on the client side. </p><p>Our implementation of subscription caching is accomplished by three global templates:</p><ul><li>with-global-subscriptions (<a href="https://github.com/radgrad/radgrad/blob/master/app/imports/ui/layouts/shared/with-global-subscriptions.html" target="_blank" rel="noopener noreferrer">html</a>, <a href="https://github.com/radgrad/radgrad/blob/master/app/imports/ui/layouts/shared/with-global-subscriptions.js" target="_blank" rel="noopener noreferrer">js</a>) creates cached subscriptions to approximately 20 RadGrad collections. These are collections that are frequently used by most users on most pages, and so it makes sense to just subscribe to them as soon as any user logs in and cache those subscriptions across all pages. </li><li>with-instance-subscriptions (<a href="https://github.com/radgrad/radgrad/blob/master/app/imports/ui/layouts/shared/with-instance-subscriptions.html" target="_blank" rel="noopener noreferrer">html</a>, <a href="https://github.com/radgrad/radgrad/blob/master/app/imports/ui/layouts/shared/with-instance-subscriptions.js" target="_blank" rel="noopener noreferrer">js</a>) creates cached subscriptions to data specific to a given user which is used across multiple pages, such as their course or opportunity instances.  </li><li>with-advisor-subscriptions (<a href="https://github.com/radgrad/radgrad/blob/master/app/imports/ui/layouts/shared/with-advisor-subscriptions.html" target="_blank" rel="noopener noreferrer">html</a>, <a href="https://github.com/radgrad/radgrad/blob/master/app/imports/ui/layouts/shared/with-advisor-subscriptions.js" target="_blank" rel="noopener noreferrer">js</a>) creates cached subscriptions for data used only by the advisor (i.e. plan choices).</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="instances-now-are-based-on-route"></a>Instances now are based on route<a aria-hidden="true" tabindex="-1" class="hash-link" href="#instances-now-are-based-on-route" title="Direct link to heading">#</a></h3><p>To improve performance for the Students, Faculty, Mentors, and Advisors, we are going to change the <code>with-instance-subscriptions</code>. We want to only get the instances for the user as defined by the route. The following is an example of doing it the right way.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">instanceSubs.subscribe(AcademicYearInstances.getPublicationName(), getUserIdFromRoute());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">instanceSubs.subscribe(CourseInstances.getPublicationName(), getUserIdFromRoute());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">instanceSubs.subscribe(OpportunityInstances.getPublicationName(), getUserIdFromRoute());</span></div></div></div></div></div><p>We pass in the userID from the route. This allows the student to subscribe to only their instances, while the advisor will only get the instances for the pages they visit. Remember advisors can view student pages.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-12-18T19:52:23.000Z" class="docLastUpdatedAt_217_">12/18/2020</time> by <strong>Philip Johnson</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#instances-now-are-based-on-route" class="table-of-contents__link">Instances now are based on route</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>RadGrad is sponsored by:<br>
                  <a href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory</a><br>
                  <a href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences</a><br>
                  <a href="http://www.hawaii.edu">University of Hawaii</a><br>
                  with funding from the National Science Foundation (Awards 1829542, 2025112)</div></div></div></footer></div>
<script src="/styles.c903600e.js"></script>
<script src="/runtime~main.2f1b480c.js"></script>
<script src="/main.13cd8f17.js"></script>
<script src="/2.405ef932.js"></script>
<script src="/3.635484bd.js"></script>
<script src="/285.d61560bf.js"></script>
<script src="/288.0762c51c.js"></script>
<script src="/935f2afb.c899150c.js"></script>
<script src="/17896441.7618caef.js"></script>
<script src="/96f83bae.d6c134a5.js"></script>
</body>
</html>