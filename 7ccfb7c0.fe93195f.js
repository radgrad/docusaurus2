(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{184:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return c})),a.d(n,"metadata",(function(){return d})),a.d(n,"rightToc",(function(){return i})),a.d(n,"default",(function(){return p}));var r=a(2),t=a(6),o=(a(0),a(345)),c={title:"Docker management"},d={unversionedId:"archive/docker/docker-management",id:"archive/docker/docker-management",isDocsHomePage:!1,title:"Docker management",description:"Here are some helpful commands for Docker management",source:"@site/docs/archive/docker/docker-management.md",slug:"/archive/docker/docker-management",permalink:"/docs/archive/docker/docker-management",version:"current",lastUpdatedBy:"Philip Johnson",lastUpdatedAt:1601689012,sidebar:"mainSidebar",previous:{title:"Deploy a release (Docker)",permalink:"/docs/archive/docker/deploy-a-release"},next:{title:"Setup SSH access",permalink:"/docs/archive/docker/setup-ssh"}},i=[{value:"Bring all services down",id:"bring-all-services-down",children:[]},{value:"Bring all services up",id:"bring-all-services-up",children:[]},{value:"Update a single service",id:"update-a-single-service",children:[]},{value:"Prune containers and images",id:"prune-containers-and-images",children:[]}],l={rightToc:i};function p(e){var n=e.components,a=Object(t.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,a,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Here are some helpful commands for Docker management"),Object(o.b)("h2",{id:"bring-all-services-down"},"Bring all services down"),Object(o.b)("p",null,"If you need to bring all services down for any reason, just change into the top-level directory (where the ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose.yml")," file is), and invoke ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose down"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"$ radgrad@radgrad2:~/radgrad-docker$ docker-compose down\nStopping radgrad-docker_certbot_1 ... done\nStopping radgrad-docker_nginx_1   ... done\nStopping radgrad-docker_radgrad_1 ... done\nStopping radgrad-mongo            ... done\nRemoving radgrad-docker_certbot_1 ... done\nRemoving radgrad-docker_nginx_1   ... done\nRemoving radgrad-docker_radgrad_1 ... done\nRemoving radgrad-mongo            ... done\nRemoving network radgrad-docker_default\n")),Object(o.b)("h2",{id:"bring-all-services-up"},"Bring all services up"),Object(o.b)("p",null,"To bring all services up, just invoke the ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose-run.sh")," script:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),'$ radgrad@radgrad2:~/radgrad-docker$ ./docker-compose-run.sh\nCreating network "radgrad-docker_default" with the default driver\nCreating radgrad-mongo ... done\nCreating radgrad-docker_radgrad_1 ... done\nCreating radgrad-docker_nginx_1   ... done\nCreating radgrad-docker_certbot_1 ... done\nradgrad@radgrad2:~/radgrad-docker$\n')),Object(o.b)("h2",{id:"update-a-single-service"},"Update a single service"),Object(o.b)("p",null,"We will occasionally make new releases of RadGrad or need a new release of MongoDB."),Object(o.b)("p",null,"On your production system, change into the ",Object(o.b)("inlineCode",{parentName:"p"},"radgrad-docker")," directory and pull the latest files by invoking:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"git pull origin master\n")),Object(o.b)("p",null,"Then, redeploy RadGrad with the latest changes by invoking the ",Object(o.b)("inlineCode",{parentName:"p"},"docker-compose-run.sh")," script:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"$ ./docker-compose-run.sh\nradgrad-docker_mongo_1 is up-to-date\nRecreating radgrad-docker_radgrad_1 ... done\n")),Object(o.b)("h2",{id:"prune-containers-and-images"},"Prune containers and images"),Object(o.b)("p",null,"As noted in the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.docker.com/config/pruning/"}),"Docker chapter on prune unused Docker objects"),", when you install new Docker images, the old ones are not automatically deleted. Over time, unused and out of date Docker objects can consume significant amounts of disk space."),Object(o.b)("p",null,"To determine if you have unused Docker containers, you can run the ",Object(o.b)("inlineCode",{parentName:"p"},"docker ps -a")," command, which lists both running and stopped containers. Here is a sample run of that command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),'$ docker ps -a\nCONTAINER ID        IMAGE                                      COMMAND                  CREATED             STATUS              PORTS                                                                                                                                                                       NAMES\na14bc92c53a1        openpowerquality/health:1.0.1              "python3 -u health.py"   3 hours ago         Up 3 hours                                                                                                                                                                                      opq-docker_health_1\n714ce76b75bb        openpowerquality/mauka:1.0.7               "python3 mauka/opq_m\u2026"   3 hours ago         Up 3 hours          8911/tcp, 9881/tcp, 9884/tcp, 0.0.0.0:9882-9883->9882-9883/tcp, 9899/tcp, 0.0.0.0:12000->12000/tcp                                                                          opq-docker_mauka_1\nc9044a3a2089        certbot/certbot                            "/bin/sh -c \'trap ex\u2026"   3 days ago          Up 3 days           80/tcp, 443/tcp                                                                                                                                                             opq-docker_certbot_1\n95e159b49a64        nginx:1.15-alpine                          "/bin/sh -c \'while :\u2026"   3 days ago          Up 3 days           0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp                                                                                                                                    opq-docker_nginx_1\n402fe9b16200        openpowerquality/makai:1.0.6               "/bin/bash /build/bi\u2026"   3 days ago          Up 13 hours         0.0.0.0:8194->8194/tcp, 0.0.0.0:8196->8196/tcp, 127.0.0.1:8080->8080/tcp, 127.0.0.1:9884->9884/tcp, 127.0.0.1:9899->9899/tcp, 0.0.0.0:9880-9881->9880-9881/tcp, 10000/tcp   opq-docker_makai_1\n741fe724f9ac        openpowerquality/view:1.0.1                "node main.js"           3 days ago          Up 3 days           80/tcp, 0.0.0.0:8888->8888/tcp                                                                                                                                              opq-docker_view_1\n00e9a674810e        mongo:4.0.5                                "docker-entrypoint.s\u2026"   3 days ago          Up 3 days           127.0.0.1:27017->27017/tcp                                                                                                                                                  opq-mongo\ne1cc09f69510        openpowerquality/box-update-server:1.0.3   "python3 box_update_\u2026"   3 days ago          Up 3 days           0.0.0.0:8151->8151/tcp                                                                                                                                                      opq-docker_boxupdateserver_1\n')),Object(o.b)("p",null,"In this sample output, all containers are current and running. Should you discover stopped and out-of-date containers, you can run the following commands to get rid of both out of date containers and images."),Object(o.b)("p",null,"To prune containers:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"$ docker container prune\nWARNING! This will remove all stopped containers.\nAre you sure you want to continue? [y/N] y\nTotal reclaimed space: 0B\n")),Object(o.b)("p",null,"To prune images:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-shell"}),"$ docker image prune -a\n  WARNING! This will remove all images without at least one container associated to them.\n  Are you sure you want to continue? [y/N] y\n  Deleted Images:\n  untagged: mongo:latest\n  untagged: mongo@sha256:c4fe6705e1dffb91d3fdb4f2c00f58a5ce9b82dd010bce33e250d320518047b5\n  deleted: sha256:a3abd47e8d61c923dd1561ad3720af4d948627c524a53d321c2a5bd6f6467060\n  deleted: sha256:9c04aae8ecf33b57edf8893881b42d7483a4ef19e871ed9687fbe40468ede99e\n  deleted: sha256:eb8c65e58c7f29789466d3d88b4961b98a4674bb0b892745d22cda11c8ce79b2\n  deleted: sha256:be8087eddc5150dbd849a4ba7870ddf01125130e0b4f700a363f0b079553fa64\n  untagged: bak-mongo:latest\n\n  Total reclaimed space: 394.4MB\n")))}p.isMDXComponent=!0},345:function(e,n,a){"use strict";a.d(n,"a",(function(){return s})),a.d(n,"b",(function(){return g}));var r=a(0),t=a.n(r);function o(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function c(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function d(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?c(Object(a),!0).forEach((function(n){o(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var l=t.a.createContext({}),p=function(e){var n=t.a.useContext(l),a=n;return e&&(a="function"==typeof e?e(n):d(d({},n),e)),a},s=function(e){var n=p(e.components);return t.a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.a.createElement(t.a.Fragment,{},n)}},b=t.a.forwardRef((function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),s=p(a),b=r,g=s["".concat(c,".").concat(b)]||s[b]||u[b]||o;return a?t.a.createElement(g,d(d({ref:n},l),{},{components:a})):t.a.createElement(g,d({ref:n},l))}));function g(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,c=new Array(o);c[0]=b;var d={};for(var i in n)hasOwnProperty.call(n,i)&&(d[i]=n[i]);d.originalType=e,d.mdxType="string"==typeof e?e:r,c[1]=d;for(var l=2;l<o;l++)c[l]=a[l];return t.a.createElement.apply(null,c)}return t.a.createElement.apply(null,a)}b.displayName="MDXCreateElement"}}]);