(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{320:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return b}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),l=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):d(d({},t),e)),n},u=function(e){var t=l(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=a,b=u["".concat(i,".").concat(m)]||u[m]||c[m]||o;return n?r.a.createElement(b,d(d({ref:t},p),{},{components:n})):r.a.createElement(b,d({ref:t},p))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var d={};for(var s in t)hasOwnProperty.call(t,s)&&(d[s]=t[s]);d.originalType=e,d.mdxType="string"==typeof e?e:a,i[1]=d;for(var p=2;p<o;p++)i[p]=n[p];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},484:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/dns-lookup-radgrad-dev-f8e45320e0e7e15f5a7da27ccc9a8bac.png"},485:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/do-droplet-328fcfdf43fca5173b1d76cb37528e79.png"},486:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/do-domain-page-3353150670a27c40676e55184136cf22.png"},487:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/do-domain-setup-1-bfcc9911c152a433a251c4396e14af13.png"},488:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/do-domain-setup-2-8f53865d87edb94fc14b35216ca14812.png"},84:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return d})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return l}));var a=n(2),r=n(6),o=(n(0),n(320)),i={title:"Setup a Digital Ocean server using Meteor Up",sidebar_label:"Setup Digital Ocean server"},d={unversionedId:"developers/deployment/howto/setup-digital-ocean-server-mup",id:"developers/deployment/howto/setup-digital-ocean-server-mup",isDocsHomePage:!1,title:"Setup a Digital Ocean server using Meteor Up",description:"This page documents the process of setting up a cloud-based server for RadGrad using Digital Ocean and Meteor Up.",source:"@site/docs/developers/deployment/howto/setup-digital-ocean-server-mup.md",slug:"/developers/deployment/howto/setup-digital-ocean-server-mup",permalink:"/docs/developers/deployment/howto/setup-digital-ocean-server-mup",version:"current",lastUpdatedBy:"Philip Johnson",lastUpdatedAt:1624224125,sidebar_label:"Setup Digital Ocean server",sidebar:"mainSidebar",previous:{title:"Setup an in-house server using Meteor Up",permalink:"/docs/developers/deployment/howto/setup-in-house-server-mup"},next:{title:"Setup Robo3T",permalink:"/docs/developers/deployment/howto/setup-robo3t"}},s=[{value:"Buy a custom domain name for your RadGrad server",id:"buy-a-custom-domain-name-for-your-radgrad-server",children:[]},{value:"Use Digital Ocean DNS for your domain name",id:"use-digital-ocean-dns-for-your-domain-name",children:[]},{value:"Create an Digital Ocean Ubuntu server (i.e. Droplet)",id:"create-an-digital-ocean-ubuntu-server-ie-droplet",children:[]},{value:"Connect your domain to your droplet",id:"connect-your-domain-to-your-droplet",children:[]},{value:"Configure app/.deploy/mup.js",id:"configure-appdeploymupjs",children:[]},{value:"Configure app/.deploy/settings.js",id:"configure-appdeploysettingsjs",children:[]},{value:"Run mup setup",id:"run-mup-setup",children:[]},{value:"Run mup deploy",id:"run-mup-deploy",children:[]},{value:"Check status of deployment through logs",id:"check-status-of-deployment-through-logs",children:[]},{value:"Find and save the admin password",id:"find-and-save-the-admin-password",children:[]},{value:"Finish initial setup",id:"finish-initial-setup",children:[]},{value:"Publishing a new release",id:"publishing-a-new-release",children:[]}],p={rightToc:s};function l(e){var t=e.components,i=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},p,i,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"This page documents the process of setting up a cloud-based server for RadGrad using ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://digitalocean.com"}),"Digital Ocean")," and ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://meteor-up.com"}),"Meteor Up"),"."),Object(o.b)("h2",{id:"buy-a-custom-domain-name-for-your-radgrad-server"},"Buy a custom domain name for your RadGrad server"),Object(o.b)("p",null,"Use a domain registrar service such as ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://namecheap.com"}),"NameCheap")," to buy a domain name for your RadGrad server. This is necessary in order to enable HTTPS for secure communication with your RadGrad server."),Object(o.b)("h2",{id:"use-digital-ocean-dns-for-your-domain-name"},"Use Digital Ocean DNS for your domain name"),Object(o.b)("p",null,"You need to tell your registrar that you will use Digital Ocean's name servers. For instructions, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars"}),"How to point to Digital Ocean Nameservers from Common Doman Registrars"),"."),Object(o.b)("p",null,"Propogating this change takes up to 24 hours, so be patient.  To check to see if it's finished, you can use ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tools/dns"}),"Digital Ocean's DNS Lookup Page"),"."),Object(o.b)("p",null,"For example, for the (newly created) radgrad.dev domain, once the transition is complete, this page displays the following:"),Object(o.b)("p",null,Object(o.b)("img",{src:n(484).default})),Object(o.b)("h2",{id:"create-an-digital-ocean-ubuntu-server-ie-droplet"},"Create an Digital Ocean Ubuntu server (i.e. Droplet)"),Object(o.b)("p",null,"Login to ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://digitalocean.com"}),"Digital Ocean"),', then click on the "Create" button and select a Droplet (Ubuntu server). Create a root password and save it someplace safe.'),Object(o.b)("p",null,"It's helpful to change the default name of your droplet to the intended custom domain name to simplify management. For example, here's the newly created droplet for \"radgrad.dev\":"),Object(o.b)("p",null,Object(o.b)("img",{src:n(485).default})),Object(o.b)("h2",{id:"connect-your-domain-to-your-droplet"},"Connect your domain to your droplet"),Object(o.b)("p",null,'In Digital Ocean, go to your Networking tab on the left menu, then click "Domains". You should see a pane like the following:'),Object(o.b)("p",null,Object(o.b)("img",{src:n(486).default})),Object(o.b)("p",null,'You can enter your new domain, then click "Add domain". Once the nameserver transfer has finished, you\'ll see "3 NS" below the domain name.'),Object(o.b)("p",null,'Next, click on the domain, put "@" for the hostname, and select your droplet:'),Object(o.b)("p",null,Object(o.b)("img",{src:n(487).default})),Object(o.b)("p",null,"After clicking Add Domain, it will look like this:"),Object(o.b)("p",null,Object(o.b)("img",{src:n(488).default})),Object(o.b)("p",null,"Once you've completed this, within a short time you should see that your domain routes to your droplet:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ nslookup radgrad.dev\nServer:     10.0.1.1\nAddress:    10.0.1.1#53\n\nNon-authoritative answer:\nName:   radgrad.dev\nAddress: 157.245.253.34\n")),Object(o.b)("h2",{id:"configure-appdeploymupjs"},"Configure app/.deploy/mup.js"),Object(o.b)("p",null,"Copy app/.deploy/sample.mup.js file to mup.js.  It will look something like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"module.exports = {\n  servers: { one: { host: 'CHANGEME.EDU', username: 'root', password: 'CHANGEME' }},\n  hooks: { 'pre.deploy': { localCommand: 'npm run update-build-version' }},\n  app: {\n    name: 'radgrad',\n    path: '../',\n    servers: { one: {}},\n    buildOptions: { serverOnly: true, debug: true },\n    env: {\n      ROOT_URL: 'https://CHANGME.EDU',\n      MONGO_URL: 'mongodb://mongodb/meteor',\n      MONGO_OPLOG_URL: 'mongodb://mongodb/local',\n    },\n    docker: { image: 'abernix/meteord:node-12-base' },\n    enableUploadProgressBar: true,\n    deployCheckWaitTime: 900\n  },\n  mongo: { version: '3.4.1', servers: { one: {} } },\n  proxy: {\n    domains: 'CHANGEME.EDU',\n    ssl: { letsEncryptEmail: 'CHANGEME@HAWAII.EDU', forceSSL: true }\n  }\n};\n")),Object(o.b)("p",null,"Note that there are several occurences of the string \u201cCHANGEME\u201d. This indicates the parts of the mup.js file that need to be configured for your application. You can edit these strings to be lower case, they are upper case only to make them stand out in the file."),Object(o.b)("p",null,'Note: that the \u201chost\u201d and "domains" values are just the domain name. For example, if your domain name is "radgrad.dev", then the value of "host" and "domains" should be just "radgrad.dev". Do not include "https://" in these fields.'),Object(o.b)("p",null,'However, the ROOT_URL includes the protocol. For example, if your domain name is "radgrad.dev", then the value of ROOT_URL should be \u201c',Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://radgrad.dev%E2%80%9D"}),"https://radgrad.dev\u201d"),"."),Object(o.b)("h2",{id:"configure-appdeploysettingsjs"},"Configure app/.deploy/settings.js"),Object(o.b)("p",null,"Copy app/.deploy/sample.settings.js to settings.js.  Edit this file to include appropriate credentials and other information specific to your deployment."),Object(o.b)("h2",{id:"run-mup-setup"},"Run mup setup"),Object(o.b)("p",null,"Inside the app/.deploy directory, invoke \u201cmup setup\u201d (or \u201cmup.cmd setup\u201d on Windows). You should get output like the following:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ mup setup\n\nStarted TaskList: Setup Docker\n[radgrad.dev] - Setup Docker\n[radgrad.dev] - Setup Docker: SUCCESS\n\nStarted TaskList: Setup Meteor\n[radgrad.dev] - Setup Environment\n[radgrad.dev] - Setup Environment: SUCCESS\n\nStarted TaskList: Setup Mongo\n[radgrad.dev] - Setup Environment\n[radgrad.dev] - Setup Environment: SUCCESS\n[radgrad.dev] - Copying Mongo Config\n[radgrad.dev] - Copying Mongo Config: SUCCESS\n\nStarted TaskList: Start Mongo\n[radgrad.dev] - Start Mongo\n[radgrad.dev] - Start Mongo: SUCCESS\n\nStarted TaskList: Setup proxy\n[radgrad.dev] - Setup Environment\n[radgrad.dev] - Setup Environment: SUCCESS\n[radgrad.dev] - Pushing the Startup Script\n[radgrad.dev] - Pushing the Startup Script: SUCCESS\n[radgrad.dev] - Pushing Nginx Config Template\n[radgrad.dev] - Pushing Nginx Config Template: SUCCESS\n[radgrad.dev] - Pushing Nginx Config\n[radgrad.dev] - Pushing Nginx Config: SUCCESS\n[radgrad.dev] - Cleaning Up SSL Certificates\n[radgrad.dev] - Cleaning Up SSL Certificates: SUCCESS\n[radgrad.dev] - Configure Nginx Upstream\n[radgrad.dev] - Configure Nginx Upstream: SUCCESS\n\nStarted TaskList: Start proxy\n[radgrad.dev] - Start proxy\n[radgrad.dev] - Start proxy: SUCCESS\n\nNext, you should run:\n    mup deploy\n$\n")),Object(o.b)("p",null,"For more details on the setup command, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://meteor-up.com/docs.html#setting-up-a-server"}),"http://meteor-up.com/docs.html#setting-up-a-server"),"."),Object(o.b)("h2",{id:"run-mup-deploy"},"Run mup deploy"),Object(o.b)("p",null,"Now you can bundle up your Meteor application, send it over to the Droplet, and start it running on your Droplet."),Object(o.b)("p",null,"Inside the app/.deploy directory, invoke \u201cmup deploy\u201d (or, on Windows \u201cmup.cmd deploy\u201d). You should get output like the following:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ mup deploy\nBuilding App Bundle Locally\n\nStarted TaskList: Pushing Meteor App\n[167.172.222.158] - Pushing Meteor App Bundle to the Server\n[167.172.222.158] - Pushing Meteor App Bundle to the Server: SUCCESS\n[167.172.222.158] - Prepare Bundle\n[167.172.222.158] - Prepare Bundle: SUCCESS\n\nStarted TaskList: Configuring App\n[167.172.222.158] - Pushing the Startup Script\n[167.172.222.158] - Pushing the Startup Script: SUCCESS\n[167.172.222.158] - Sending Environment Variables\n[167.172.222.158] - Sending Environment Variables: SUCCESS\n\nStarted TaskList: Start Meteor\n[167.172.222.158] - Start Meteor\n[167.172.222.158] - Start Meteor: SUCCESS\n[167.172.222.158] - Verifying Deployment\n[167.172.222.158] - Verifying Deployment: SUCCESS\n")),Object(o.b)("p",null,"For more details on the deploy command, see ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://meteor-up.com/docs.html#deploying-an-app"}),"http://meteor-up.com/docs.html#deploying-an-app"),"."),Object(o.b)("p",null,"After deployment finishes, the app should be live."),Object(o.b)("h2",{id:"check-status-of-deployment-through-logs"},"Check status of deployment through logs"),Object(o.b)("p",null,"To ensure that what you wanted to have happen actually happened, check the logs with mup logs:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"mup logs\n")),Object(o.b)("p",null,"Sample invocation and results:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell"}),"mup logs\n[radgrad2.ics.hawaii.edu]=> Starting meteor app on port:3000\n[radgrad2.ics.hawaii.edu]Monti APM: completed instrumenting the app\n[radgrad2.ics.hawaii.edu]Beginning startup.\n[radgrad2.ics.hawaii.edu]Invoking defineAdminUser\n[radgrad2.ics.hawaii.edu]Defining admin radgrad@hawaii.edu with password asfasdf\n[radgrad2.ics.hawaii.edu]Invoking loadDatabase\n[radgrad2.ics.hawaii.edu]Monti APM: Successfully connected\n")),Object(o.b)("h2",{id:"find-and-save-the-admin-password"},"Find and save the admin password"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Extremely Important Note:"),"  Each time you start up RadGrad and initialize it with a new database, a new admin password will be generated and the log file will be the only place it is made available.  You must print the logs by running ",Object(o.b)("inlineCode",{parentName:"p"},"mup logs"),", find the line that indicates the admin password within the logs, and save that password someplace safe."),Object(o.b)("p",null,"Note that the logs are cleared each time you deploy an update, so it is important to find and save that admin password."),Object(o.b)("p",null,"If you forget to save the admin password, you will need to clear the database and reinitialize the system from scratch in order to regenerate it. There is no way to recover it after it is deleted from the logs."),Object(o.b)("h2",{id:"finish-initial-setup"},"Finish initial setup"),Object(o.b)("p",null,"See the next sections for additional setup instructions, including:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"./setup-cas"}),"Setup CAS authentication")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"./setup-robo3t"}),"Setup Robo3T")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"./setup-montiapm"}),"Setup MontiAPM"))),Object(o.b)("h2",{id:"publishing-a-new-release"},"Publishing a new release"),Object(o.b)("p",null,"Once you have successfully set up your RadGrad server, subsequent updates to the system are much more simple."),Object(o.b)("p",null,"See ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"./publish-a-release-mup"}),"Publishing a new release")," for details."))}l.isMDXComponent=!0}}]);