(window.webpackJsonp=window.webpackJsonp||[]).push([[227],{286:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return s})),a.d(t,"rightToc",(function(){return c})),a.d(t,"default",(function(){return d}));var n=a(2),i=a(6),r=(a(0),a(345)),o={title:"User Interactions"},s={unversionedId:"developers/design/app/imports/api/user-interactions",id:"developers/design/app/imports/api/user-interactions",isDocsHomePage:!1,title:"User Interactions",description:"Motivation",source:"@site/docs/developers/design/app/imports/api/user-interactions.md",slug:"/developers/design/app/imports/api/user-interactions",permalink:"/docs/developers/design/app/imports/api/user-interactions",version:"current",lastUpdatedBy:"Philip Johnson",lastUpdatedAt:1619721040,sidebar:"mainSidebar",previous:{title:"How to manage users",permalink:"/docs/developers/design/app/imports/api/manage-users"},next:{title:"Overview of ui/",permalink:"/docs/developers/design/app/imports/ui/overview"}},c=[{value:"Motivation",id:"motivation",children:[]},{value:"Basic mechanisms",id:"basic-mechanisms",children:[]},{value:"Sessions",id:"sessions",children:[]},{value:"Behaviors",id:"behaviors",children:[]},{value:"The daily cron job",id:"the-daily-cron-job",children:[]}],l={rightToc:c};function d(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"motivation"},"Motivation"),Object(r.b)("p",null,'To support the RadGrad research process, and to provide usability feedback to support improvements in design, RadGrad implements a feature called "User Interactions". The goal of User Interactions is to collect data about usage of the system and present it in the form of "behaviors".  User Interactions are not designed to support low-level analysis of user behavior, such as "what page is the user most likely to visit when they are on page X?".  Instead, they are designed to support high-level analysis of user behavior, such as "What percentage of users have \'completed\' their degree plan (i.e. added enough courses and opportunities to eventually earn 100 Innovation, 100 Competency, and 100 Experience points)?"'),Object(r.b)("h2",{id:"basic-mechanisms"},"Basic mechanisms"),Object(r.b)("p",null,"User Interactions are implemented with the following mechanisms:"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"The UserInteraction collection."),' Each document in this collection records one "behavior" of a user, such as "Logging in" or "Visiting the Career Goal Explorer page". Each of these document is timestamped, but at the grain-size of a day (i.e. YYYY-MM-DD). So, the UserInteraction collection can tell you that a specific user visited a specific page on a specific day, but not how many times during the day they visited that page, nor what precise time during the day did that visit occur. This coarse-grained approach reduces the volume of the UserInteraction collection, and greatly simplifies collection and analysis, but of course limits the kinds of analyses that can be performed. We are comfortable with this trade-off.'),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"The UserInteraction Manager class.")," The User Interaction Manager is a class which creates a singleton instance in the server. This instance provides methods to build an in-memory \"snapshot\" of the state of the system once a day, and compares the current day's snapshot to the previous day's snapshot in order to generate UserInteraction documents."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"The lastVisited field of User Profiles."),' All user Profiles contain a field called "lastVisited", which stores the most recent date (in YYYY-MM-DD format) that the user visited each page in the system.  One purpose of this field is to support Checklist items that remind the user to perform certain actions if they have not visited a page in a long time. This field is also used by the User Interaction manager to see if a user has visited a given page on the current day, and if so, generate an appropriate UserInteraction document.'),Object(r.b)("h2",{id:"sessions"},"Sessions"),Object(r.b)("p",null,'For the purpose of analysis, a user "session" is defined as "all pages visited during the period of a single calendar day". So, either a single day has a session for a given user, or it doesn\'t. The number of sessions for a given user in a given month is simply all of the days in that month in which the user visited at least one page.'),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"Midnight crossing visits")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},'Users who start to browse the system shortly before midnight, and then continue on past midnight, will have two sessions recorded for them instead of one. We will live with this edge case because "session detection" is a difficult problem in general and getting a more accurate count of the number of sessions is not important for our purposes. We are more concerned with trends in the number of sessions over time, and it is reasonable to expect that the number of "midnight-crossing visits" will be more or less equally distributed (and relatively infrequent.)'))),Object(r.b)("h2",{id:"behaviors"},"Behaviors"),Object(r.b)("p",null,"We want to classify low-level user interactions with the system into a small set of higher-level behaviors: Login, Change Outlook, Explore, Plan, Verify, Review, Level Up, Complete Plan, and Change Visibility."),Object(r.b)("p",null,"Here's a table that indicates how each behavior is recognized by the system"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Behavior"),Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"New Approach"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Login"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Any page visited on a day implies a login behavior. Recorded via daily cron job, using lastVisited field of user profile.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Change Outlook"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Changes to profile regarding Interests, Career Goals, Courses, or Opportunities. Recorded via daily cron job, using in-memory snapshot.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Explore"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Visiting the corresponding explorer page. Recorded via cron job, using lastVisited field of user profile.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Plan"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Visiting the Degree Plan page. Recorded via daily cron job, using lastVisited field of user profile.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Verify"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Student submits a new verification request. Via daily cron job, using createdAt field of Verification Request collection.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Review"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Student submits a review. Via daily cron job, using createdAt field of Review collection.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"LevelUp"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Recorded via daily cron job, using in-memory snapshot.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Complete Plan"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Recorded via daily cron job, using in-memory snapshot.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Change Visibility"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Recorded via daily cron job, using in-memory snapshot.")))),Object(r.b)("p",null,"The record of behaviors is stored in the UserInteraction collection.  Each document in the UserInteractionCollection contains four fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Username: the user email."),Object(r.b)("li",{parentName:"ul"},"Type: an enumerated type indicating the behavior being recorded, from the above list."),Object(r.b)("li",{parentName:"ul"},"TypeData: an array that can optionally contain additional information about the behavior."),Object(r.b)("li",{parentName:"ul"},"Timestamp: indicates the day associated with this behavior.")),Object(r.b)("h2",{id:"the-daily-cron-job"},"The daily cron job"),Object(r.b)("p",null,"Behaviors are recognized and recorded during the execution of a daily cron job.  This cron job runs shortly before midnight, and does the following:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Checks the lastVisited field for each user and generates UserInteraction documents for that day if appropriate."),Object(r.b)("li",{parentName:"ol"},'Creates a snapshot for each user of aspects of their "state" for the current day, including their current level, degree plan, etc.'),Object(r.b)("li",{parentName:"ol"},"When comparison of today's snapshot with yesterday's indicates a relevant change in state from the prior day, generate a UserInteraction document.")),Object(r.b)("p",null,'The cron job is called the "UserInteractionStateManager", and the in-memory data structure called the "UserInteractionSnapshot (UIS). The UIS data structure is built immediately upon system startup by traversing collections and building an object whose keys are usernames and whose associated values is an object. For example:'),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{}),'{ "johnson@hawaii.edu": {\n    interests: list of Interest slugs in this user\'s profile.\n    careerGoals: list of CareerGoal slugs in this user\'s profile.\n    level: the current level for this user (1-6)\n    degreePlanComplete: true if complete\n  }\n "foo@hawaii.edu": { ... },\n "baz@hawaii.edu": { ... },\n}\n')),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"Design limitations of in-memory (non-persistent) snapshots")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("h4",Object(n.a)({parentName:"div"},{id:"data-loss"}),"Data Loss"),Object(r.b)("p",{parentName:"div"},"We acknowledge that using an in-memory data structure does create the possibility of data loss. Consider the following sequence of actions:"),Object(r.b)("ul",{parentName:"div"},Object(r.b)("li",{parentName:"ul"},"The cron job crashes."),Object(r.b)("li",{parentName:"ul"},"A user, for example achieves a new level."),Object(r.b)("li",{parentName:"ul"},"The cron job starts up again, and initializes the snapshot with the user's new level."),Object(r.b)("li",{parentName:"ul"},"When the update occurs that night, the fact that the user achieved a new level is lost.")),Object(r.b)("p",{parentName:"div"},"Data loss can only happen when the cron job crashes but the site stays up.  This seems quite unlikely, and the impact small enough in terms of data loss, that we will take that risk."),Object(r.b)("h4",Object(n.a)({parentName:"div"},{id:"spurious-userinteractions-upon-database-dump-and-restore"}),"Spurious UserInteractions upon database dump and restore"),Object(r.b)("p",{parentName:"div"},"Many UserInteractions are generated based upon checking the createdAt field of documents.  This works great and is easy to implement, but suffers from the following potential problem: if the database is dumped and then restored, a large number of spurious UserInteractions will be generated that first day because the createdAt field will reflect the day that the database is restored, not the day that the behavior actually occurred."),Object(r.b)("p",{parentName:"div"},"For the moment, we just recognize this as an analysis problem. One way to manage it is to restore the database close to midnight (so that there are minimal user interactions with the system), then disable the cron job until the next day. Other approaches could include ignoring all entries for a given day."))))}d.isMDXComponent=!0},345:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return u}));var n=a(0),i=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=i.a.createContext({}),d=function(e){var t=i.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},b=function(e){var t=d(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},h=i.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=d(a),h=n,u=b["".concat(o,".").concat(h)]||b[h]||p[h]||r;return a?i.a.createElement(u,s(s({ref:t},l),{},{components:a})):i.a.createElement(u,s({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var l=2;l<r;l++)o[l]=a[l];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);