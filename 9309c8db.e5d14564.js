(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{216:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"rightToc",(function(){return d})),a.d(t,"default",(function(){return s}));var n=a(2),r=a(6),o=(a(0),a(345)),c={title:"Build and publish a new release of RadGrad",sidebar_label:"Build a release (Docker)"},i={unversionedId:"archive/docker/build-a-release",id:"archive/docker/build-a-release",isDocsHomePage:!1,title:"Build and publish a new release of RadGrad",description:"We utilize Docker and Docker Compose to containerize and deploy RadGrad.  For Mongo, we use the official Mongo image without modification.",source:"@site/docs/archive/docker/build-a-release.md",slug:"/archive/docker/build-a-release",permalink:"/docs/archive/docker/build-a-release",version:"current",lastUpdatedBy:"Philip Johnson",lastUpdatedAt:1601689012,sidebar_label:"Build a release (Docker)",sidebar:"mainSidebar",previous:{title:"Setup a production server using Docker",permalink:"/docs/archive/docker/setup-production-server"},next:{title:"Deploy a release (Docker)",permalink:"/docs/archive/docker/deploy-a-release"}},d=[{value:"Install Docker and Docker Compose",id:"install-docker-and-docker-compose",children:[]},{value:"Build a new Docker Image",id:"build-a-new-docker-image",children:[]},{value:"Publish the Image to DockerHub",id:"publish-the-image-to-dockerhub",children:[]},{value:"Update the RadGrad Docker Compose .env file",id:"update-the-radgrad-docker-compose-env-file",children:[]},{value:"Create a new opq-docker release",id:"create-a-new-opq-docker-release",children:[]}],l={rightToc:d};function s(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"We utilize ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.docker.com/"}),"Docker")," and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/compose/"}),"Docker Compose")," to containerize and deploy RadGrad.  For Mongo, we use the official Mongo image without modification."),Object(o.b)("p",null,"This page provides documentation on the standard procedures used to build a new release of RadGrad using Docker. The basic steps are shown in the right sidebar and documented in the following sections."),Object(o.b)("p",null,"The next sections document each of these steps."),Object(o.b)("h2",{id:"install-docker-and-docker-compose"},"Install Docker and Docker Compose"),Object(o.b)("p",null,"Make sure you have Docker and Docker Compose installed on your development and production systems."),Object(o.b)("p",null,"Please refer to the official ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/install/"}),"Docker install documentation")," and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/compose/install/"}),"Docker-Compose install documentation")," for installation instructions.  If you are on a Mac or Windows, you can install ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.docker.com/products/docker-desktop"}),"Docker Desktop"),"."),Object(o.b)("p",null,"In addition, you will need an account on DockerHub, and your account will need to be a member of the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://hub.docker.com/u/radgrad"}),"DockerHub RadGrad organization"),"."),Object(o.b)("h2",{id:"build-a-new-docker-image"},"Build a new Docker Image"),Object(o.b)("p",null,"The radgrad2 repo contains a directory named docker/ containing a script called docker-build.sh."),Object(o.b)("p",null,"To build a new Docker image,  ",Object(o.b)("inlineCode",{parentName:"p"},"cd")," into the ",Object(o.b)("inlineCode",{parentName:"p"},"/docker")," subdirectory, and invoke ",Object(o.b)("inlineCode",{parentName:"p"},"docker-build.sh"),". This command takes 5-10 minutes to complete on my laptop."),Object(o.b)("p",null,"A typical run looks like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"$ ./docker-build.sh\n=> Installing app's npm packages, then building Meteor app bundle...\n\n(stuff deleted)\n\nStep 1/7 : FROM node:12.18.4\n ---\x3e 28faf336034d\nStep 2/7 : WORKDIR /radgrad\n ---\x3e Running in b7ac0d5db543\nRemoving intermediate container b7ac0d5db543\n ---\x3e 1a206d81b65a\nStep 3/7 : COPY . /radgrad\n ---\x3e edd67610c60e\nStep 4/7 : RUN cd /radgrad/programs/server && npm install --unsafe-perm\n ---\x3e Running in 97db0fb25f8c\n\n(stuff deleted)\n\nRemoving intermediate container 97db0fb25f8c\n ---\x3e 27d559ab99b7\nStep 5/7 : EXPOSE 80\n ---\x3e Running in 8da236f19868\nRemoving intermediate container 8da236f19868\n ---\x3e 0abffad25026\nStep 6/7 : EXPOSE 8888\n ---\x3e Running in 1d356c3ea524\nRemoving intermediate container 1d356c3ea524\n ---\x3e a5387df2a689\nStep 7/7 : CMD [\"node\", \"main.js\"]\n ---\x3e Running in 90e38cb8fd46\nRemoving intermediate container 90e38cb8fd46\n ---\x3e c247633a9816\nSuccessfully built c247633a9816\nSuccessfully tagged radgrad:latest\n=> Deleting all temporary files...\n=> Docker build complete!\n=> Use the 'docker image ls' command to check that the 'radgrad' image was successfully generated\n $\n\n")),Object(o.b)("p",null,"The result of the build will be a new Docker image named ",Object(o.b)("inlineCode",{parentName:"p"},"radgrad:latest"),"."),Object(o.b)("p",null,"Once the script has finished running, you can confirm that the image has been successfully created by invoking the ",Object(o.b)("inlineCode",{parentName:"p"},"docker image ls")," command."),Object(o.b)("h2",{id:"publish-the-image-to-dockerhub"},"Publish the Image to DockerHub"),Object(o.b)("p",null,"First, make sure that your DockerHub account is a member of the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://hub.docker.com/orgs/radgrad"}),"RadGrad DockerHub organization"),"."),Object(o.b)("p",null,"Second, determine the new version number you'll associate with your image.  Use ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://hub.docker.com/r/radgrad/radgrad/tags"}),"https://hub.docker.com/r/radgrad/radgrad/tags")," to determine the current DockerHub version number associated with RadGrad."),Object(o.b)("p",null,"You'll want to increment the major, minor, or bugfix component of the current version number to get the new version number."),Object(o.b)("p",null," Third, invoke the docker tag command to attach the new version number. For example, here is the command to tag the newly built image with the new version number 2.0.12:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"$ docker tag radgrad:latest radgrad/radgrad:2.0.12\n")),Object(o.b)("p",null," Fourth, publish the tagged image to DockerHub. To do this, login to your DockerHub account by invoking the ",Object(o.b)("inlineCode",{parentName:"p"},"docker login")," command."),Object(o.b)("p",null," Then push the image to the radgrad organization on DockerHub by invoking the ",Object(o.b)("inlineCode",{parentName:"p"},"docker push")," command. Here's an example of pushing the image that's been tagged with the new version number 2.0.12:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"$ docker push radgrad/radgrad:2.0.12\nThe push refers to repository [docker.io/radgrad/radgrad]\n274a938dfe74: Pushed\nc447352fa851: Pushed\ndf9fbba33a0d: Pushed\nbe0fb77bfb1f: Layer already exists\n63c810287aa2: Layer already exists\n2793dc0607dd: Layer already exists\n74800c25aa8c: Layer already exists\nba504a540674: Layer already exists\n81101ce649d5: Layer already exists\ndaf45b2cad9a: Layer already exists\n8c466bf4ca6f: Layer already exists\n2.0.12: digest: sha256:b0299638d1528390399a43fff74f71f397780e70d5f4432218cb5c12d7cf0d66 size: 2636\n")),Object(o.b)("h2",{id:"update-the-radgrad-docker-compose-env-file"},"Update the RadGrad Docker Compose .env file"),Object(o.b)("p",null," Once the image containing the new version of RadGrad is pushed to DockerHub, you can now update the Docker Compose .env file in the radgrad-docker repository to indicate that future installations of RadGrad should use this new image."),Object(o.b)("p",null," To do this, checkout the  ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/radgrad/radgrad-docker"}),"radgrad-docker repository")," from GitHub. You must have commit privileges to this repo."),Object(o.b)("p",null," Next, edit the .env file.  The first section of the file specifies the version of the image file. A recent version looks like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"RADGRAD_IMAGE=radgrad/radgrad:2.0.1\n")),Object(o.b)("p",null,"Edit this file to update the version number associated with your service to its new version number."),Object(o.b)("p",null,"Commit this change to GitHub."),Object(o.b)("h2",{id:"create-a-new-opq-docker-release"},"Create a new opq-docker release"),Object(o.b)("p",null,"Now it is time to document your update. We do this by making an ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/radgrad/radgrad-docker/releases"}),"radgrad2 release"),"."),Object(o.b)("p",null,"Please name your release as a date in YYYY-MM-DD format. Use the description field to briefly describe the updates in this release."),Object(o.b)("p",null,"If you now want to deploy your new release, continue to the next section."))}s.isMDXComponent=!0},345:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),s=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=s(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,l=d(e,["components","mdxType","originalType","parentName"]),u=s(a),p=n,m=u["".concat(c,".").concat(p)]||u[p]||b[p]||o;return a?r.a.createElement(m,i(i({ref:t},l),{},{components:a})):r.a.createElement(m,i({ref:t},l))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,c=new Array(o);c[0]=p;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i.mdxType="string"==typeof e?e:n,c[1]=i;for(var l=2;l<o;l++)c[l]=a[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"}}]);